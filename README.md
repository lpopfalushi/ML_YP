# ML_YP
# Обучение с учителем: качество модели
_____
## Описание исследования

HR-аналитики компании «Работа с заботой» помогают бизнесу оптимизировать управление персоналом: бизнес предоставляет данные, а аналитики предлагают, как избежать финансовых потерь и оттока сотрудников.

Компания предоставила данные с характеристиками сотрудников компании. Среди них — уровень удовлетворённости сотрудника работой в компании. Эту информацию получили из форм обратной связи: сотрудники заполняют тест-опросник, и по его результатам рассчитывается доля их удовлетворённости от 0 до 1, где 0 — совершенно неудовлетворён, 1 — полностью удовлетворён. 
Собирать данные такими опросниками не так легко: компания большая, и всех сотрудников надо сначала оповестить об опросе, а затем проследить, что все его прошли. 
У вас будет несколько задач. Первая — построить модель, которая сможет предсказать уровень удовлетворённости сотрудника на основе данных заказчика. 
_____
## Цель исследования
    
Разработать решение, которое позволит проанализировать данные по сотрудникам, спрогнозировать возможный отток и причины, для разработки рекомендаций по удержанию сотрудников и уменьшению финансового влияния оффбординга и онбординга. Почему бизнесу это важно: удовлетворённость работой напрямую влияет на отток сотрудников. А предсказание оттока — одна из важнейших задач HR-аналитиков. Внезапные увольнения несут в себе риски для компании, особенно если уходит важный сотрудник.
    
_____
## Задачи исследования
1. Построить модель, которая сможет предсказать уровень удовлетворённости сотрудника на основе данных заказчика..
2. Построить модель, которая сможет на основе данных заказчика предсказать то, что сотрудник уволится из компании
_____
### Исходные данные.
    
Мы будем работать со следующими датасетами:
1. train_job_satisfaction_rate, test_features, test_target_job_satisfaction_rate: тренировочная выборка, тестовая с входными признаками, тестовая с целевым признаком satisfaction_rate
2. train_quit, test_features, test_target_quit: тренировочная выборка, тестовая с входными признаками, тестовая с целевым признаком quit
    
1. train_job_satisfaction_rate.csv Таблица, которая содержит данные о результатах опроса и характеристики сотрудника, влияющие на потенциальный отток
- id — уникальный идентификатор сотрудника;
- dept — отдел, в котором работает сотрудник;
- level — уровень занимаемой должности;
- workload — уровень загруженности сотрудника;
- employment_years — длительность работы в компании (в годах);
- last_year_promo — показывает, было ли повышение за последний год;
- last_year_violations — показывает, нарушал ли сотрудник трудовой договор за последний год;
- supervisor_evaluation — оценка качества работы сотрудника, которую дал руководитель;
- salary — ежемесячная зарплата сотрудника;
- job_satisfaction_rate — уровень удовлетворённости сотрудника работой в компании, целевой признак.
2. quit.csv Таблица, которая содержит те же входные признаки, что и в предыдущей задаче. Однако целевой признак отличается: это quit — увольнение сотрудника из компании.
- id — уникальный идентификатор сотрудника;
- dept — отдел, в котором работает сотрудник;
- level — уровень занимаемой должности;
- workload — уровень загруженности сотрудника;
- employment_years — длительность работы в компании (в годах);
- last_year_promo — показывает, было ли повышение за последний год;
- last_year_violations — показывает, нарушал ли сотрудник трудовой договор за последний год;
- supervisor_evaluation — оценка качества работы сотрудника, которую дал руководитель;
- salary — ежемесячная зарплата сотрудника;
- quit — увольнение сотрудника из компании.
**Цель исследования:**
HR-аналитики компании «Работа с заботой» помогают бизнесу оптимизировать управление персоналом: бизнес предоставляет данные, а аналитики предлагают, как избежать финансовых потерь и оттока сотрудников.

Необходимо разработать решение, которое позволит проанализировать данные по сотрудникам, спрогнозировать возможный отток и причины, для разработки рекомендаций по удержанию сотрудников и уменьшению финансового влияния оффбординга и онбординга. Почему бизнесу это важно: удовлетворённость работой напрямую влияет на отток сотрудников. А предсказание оттока — одна из важнейших задач HR-аналитиков. Внезапные увольнения несут в себе риски для компании, особенно если уходит важный сотрудник.

**Задачи**
1. Построить модель, которая сможет предсказать уровень удовлетворённости сотрудника на основе данных заказчика..
2. Построить модель, которая сможет на основе данных заказчика предсказать то, что сотрудник уволится из компании

**Ход работы:**

**Задача 1**
1. загрузили и проверили 3 датафрейма: Данные состоят из одного набора данных, разделенных на тренировочну и тестовую, тестовая разделена на таблицу со входными признаки и целевым признаком: train_job_satisfaction_rate, test_features, test_target_job_satisfaction_rate. все данные в таблицах соответствовали описанию  
2. Предобработка данных: Пропущенные значения имеются, в ходе обработки будут заменены на медианные значения  в пайплайне. Замена опечатки в столбце "level" - 'sinor' -> 'senior'
3. Исследовательский анализ данных: аномалии в данных отсутствовали. Построили графики зависимостей по критериям от целевого. Сделали вывод по распределению категорий по двум уровням лояльности. 
4. Подготовили данные для модели: загрузили данные, написали функцию проверки качества модели sMAPE, создали пайплайн для обработки данных.
5. используя пайплайн для обработки данных, и метод OptunaSearchCV, подобрали параметры для методов: DecisionTreeRegressor и KNeighborsRegressor:
   1. Обучили методом DecisionTreeRegressor
    - параметры лучшей модели 'max_depth': 11, 'min_samples_leaf': 3, 'min_samples_split': 8
    - метрика лучшей модели на кроссвалидационной выборке - Best score: 15.25. Цель меньше 15
    - метрика sMAPE на тестовой выборке - Best score: 3.66
   2. Обучили методом KNeighborsRegressor
    - параметры лучшей модели {'n_neighbors': 3}
    - метрика лучшей модели на кроссвалидационной выборке - Best score: 18.56. Цель была меньше 15
    - метрика sMAPE на тестовой выборке - Best score: 14.42
6. Параметры лучшей модели:
    - DecisionTreeRegressor(max_depth=16, max_features=11, min_samples_leaf=5, min_samples_split=14, random_state=42)
    - OneHotEncoder для категориальных признаков
    - MinMaxScaler для числовых признаков.
    - Метрика лучшей модели на кроссвалидационной выборке: 15.3
    - Метрика лучшей модели на тестовой выборке 4,1

**Задача 2**

1. загрузили и проверили 3 датафрейма: Данные состоят из одного набора данных, разделенных на тренировочну и тестовую, тестовая разделена на таблицу со входными признаки и целевым признаком: train_quit, test_features, test_target_quit. все данные в таблицах соответствовали описанию  
2. Предобработка данных: Пропущенные значения имеются, в ходе обработки будут заменены на медианные значения  в пайплайне. Замена опечатки в столбце "level" - 'sinor' -> 'senior'
3. Исследовательский анализ данных: в ходе этапа был сформирован портрет уволившегося сотрудника:
   - стаж работы 1-3 лет
    - ценка качества работы сотрудника, которую дал руководитель пик 3, и интересно что с 4 больше чем с 2, что может говорить о том, что сотрудник уходит не потому что он не компетентен, а возможно потому что его перекупают другие компании
    - зарплата до 40 тыс с пиком в 15 тыс и в 20 тыс, что говорит об утечке джунов, возможно, которых не повысили до мидлов
    - больше всего уволившихся в департаменте продаж, судя по пред исследовательскому анализу данных, у них же медиана зп ниже, на втором мисте идет ИТ-департамент
    - по должности это уровень джун, на втором месте миддл
    - больше всего с загрузкой низвкой и средней, говорит о том что чаще всего кандидаты уходят из-за невозможности вырасти по hard-skills и как следствие не вырасти по деньгам
    - специалиста за последний год не повышали
    - специалист чаще всего не нарушал внутренние распорядки, есть доля в ушедших кто нарушал, но это и закономерно, я бы исключила данный факт из гипотез
  Визуализировали и сравнили распределения признака job_satisfaction_rate для ушедших и оставшихся сотрудников. Использовали данные с обоими целевыми признаками тестовой выборки. Проверили гипротезу о взаимосвязи уровня удовлетворенности сотрудника и его уходом, наблюдается корреляция по границе 0,5 уровня удовлетворенности сотрудников, все что выше - остаются, ниже - уходят
4. Добавили новый входной признак job_satisfaction_rate к тренировочной и тестовой выборкам
5. Подготовили данные для модели через пайплайн
6. Используя метод поиска гиперпараметров GridSearchCV, подобрали параметры и выбрали лучшую модель для предсказания увольняющихся сотрудников, для оценки качества моделей использовали метрику ROC-AUC, так как она лучше подходит для бинарной классификации в небольшим дисбалансом:
    - DecisionTreeClassifier(max_depth=5, max_features=6, min_samples_leaf=14, min_samples_split=10, random_state=42).
    - Метрика лучшей модели на кроссвалидационной выборке: 0.93

**"Портрет уволившегося сотрудника"**

    - стаж работы 1-3 лет
    - ценка качества работы сотрудника, которую дал руководитель пик 3, и интересно что с 4 больше чем с 2, что может говорить о том, что сотрудник уходит не потому что он не компетентен, а возможно потому что его перекупают другие компании
    - зарплата до 40 тыс с пиком в 15 тыс и в 20 тыс, что говорит об утечке джунов, возможно, которых не повысили до мидлов
    - больше всего уволившихся в департаменте продаж, судя по пред исследовательскому анализу данных, у них же медиана зп ниже, на втором мисте идет ИТ-департамент
    - по должности это уровень джун, на втором месте миддл
    - больше всего с загрузкой низвкой и средней, говорит о том что чаще всего кандидаты уходят из-за невозможности вырасти по hard-skills и как следствие не вырасти по деньгам
    - специалиста за последний год не повышали
    - специалист чаще всего не нарушал внутренние распорядки, есть доля в ушедших кто нарушал, но это и закономерно, я бы исключила данный факт из гипотез
    
 **Рекомендации бизнесу:**
 
 - Обратить внимание на молодых специалистов и проработать с ними индивидуальные планы развития, для синхронизации ожиданий бизнеса и готовности кадров, составить бизнес-план роста сотрудников, сопоставить с целями компании (заложить бюджет на повышения) и diamond-shapes
 - регулярные performance-review
 - проработать командообразующие мероприятия в департаментах продаж и ИТ. на ИТ-департамент посомтреть с точки зрения ухода сотрудников к конкурентам, оценить затраты на онбординг и офбординг и сформулировать стратегические цели по удержанию сотрудников
 - проработать регламенты повышения сотрудников

**C точки зрения модели наиболее важные признаки для прогноза ухода**

1. job_satisfaction_rate — уровень удовлетворённости сотрудника работой в компании, целевой признак.
2. employment_years — длительность работы в компании (в годах);
3. salary — ежемесячная зарплата сотрудника;
4. level — уровень занимаемой должности;
5. supervisor_evaluation - оценка качества работы сотрудника, которую дал руководитель;